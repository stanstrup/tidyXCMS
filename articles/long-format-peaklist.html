<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Creating Long-Format Peak Tables with Optional CAMERA Annotations • tidyXCMS</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Creating Long-Format Peak Tables with Optional CAMERA Annotations">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidyXCMS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Home"><span class="fa fas fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/long-format-peaklist.html">Creating Long-Format Peak Tables</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stanstrup/tidyXCMS" aria-label="GitHub repository"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Creating Long-Format Peak Tables with Optional CAMERA Annotations</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/stanstrup/tidyXCMS/blob/main/vignettes/long-format-peaklist.Rmd" class="external-link"><code>vignettes/long-format-peaklist.Rmd</code></a></small>
      <div class="d-none name"><code>long-format-peaklist.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>tidyXCMS</code> package provides functions to work with
XCMS metabolomics data in a tidy, long-format structure. This vignette
demonstrates how to use the <code><a href="../reference/XCMSnExp_CAMERA_peaklist_long.html">XCMSnExp_CAMERA_peaklist_long()</a></code>
function to create a comprehensive peak table that integrates:</p>
<ul>
<li>Peak detection results from XCMS</li>
<li>Feature grouping (correspondence) information</li>
<li>CAMERA annotations (isotopes, adducts, pseudospectrum groups) -
<strong>optional</strong>
</li>
<li>Sample metadata</li>
</ul>
<p>The resulting long-format table has one row per feature per sample,
making it ideal for downstream analysis with tidyverse tools like
<code>dplyr</code> and <code>ggplot2</code>.</p>
<p><strong>Note:</strong> CAMERA annotations are optional. You can
create a peak table without CAMERA annotations by simply omitting the
<code>xsAnnotate</code> parameter.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stanstrup.github.io/tidyXCMS">tidyXCMS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sneumann/xcms" class="external-link">xcms</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lgatto.github.io/MSnbase" class="external-link">MSnbase</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://msbi.ipb-halle.de/msbi/CAMERA/" class="external-link">CAMERA</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">commonMZ</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Bioconductor/BiocParallel" class="external-link">BiocParallel</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/MsExperiment" class="external-link">MsExperiment</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-workflow">Example Workflow<a class="anchor" aria-label="anchor" href="#example-workflow"></a>
</h2>
<div class="section level3">
<h3 id="load-example-data">Load Example Data<a class="anchor" aria-label="anchor" href="#load-example-data"></a>
</h3>
<p>We’ll use the <code>xmse</code> dataset from XCMS, which contains
preprocessed LC-MS data from wild-type and knockout samples. This
dataset already has peak detection and feature grouping completed.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load example data from XCMS (already preprocessed)</span></span>
<span><span class="va">xdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/loadXcmsData.html" class="external-link">loadXcmsData</a></span><span class="op">(</span><span class="st">"xmse"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fix file paths to use correct system-specific location</span></span>
<span><span class="co"># Get current dataOrigin values (these are repeated for each spectrum)</span></span>
<span><span class="va">current_origins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectra</a></span><span class="op">(</span><span class="va">xdata</span><span class="op">)</span><span class="op">$</span><span class="va">dataOrigin</span></span>
<span></span>
<span><span class="co"># Get unique file paths</span></span>
<span><span class="va">unique_old_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">current_origins</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract relative paths (e.g., "KO/ko15.CDF", "WT/wt15.CDF")</span></span>
<span><span class="va">relative_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">".*/faahKO/cdf/"</span>, <span class="st">""</span>, <span class="va">unique_old_paths</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get the correct base path for faahKO package on this system</span></span>
<span><span class="va">cdf_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/find.package.html" class="external-link">find.package</a></span><span class="op">(</span><span class="st">"faahKO"</span><span class="op">)</span>, <span class="st">"cdf"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reconstruct full paths</span></span>
<span><span class="va">unique_new_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">cdf_path</span>, <span class="va">relative_paths</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a named vector for path mapping</span></span>
<span><span class="va">path_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="va">unique_new_paths</span>, <span class="va">unique_old_paths</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Replace all dataOrigin values (vectorized replacement)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectra</a></span><span class="op">(</span><span class="va">xdata</span><span class="op">)</span><span class="op">$</span><span class="va">dataOrigin</span> <span class="op">&lt;-</span> <span class="va">path_map</span><span class="op">[</span><span class="va">current_origins</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Check the sample information</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">xdata</span><span class="op">)</span></span>
<span><span class="co">#&gt; DataFrame with 8 rows and 4 columns</span></span>
<span><span class="co">#&gt;   sample_name sample_group spectraOrigin sample_type</span></span>
<span><span class="co">#&gt;   &lt;character&gt;  &lt;character&gt;   &lt;character&gt; &lt;character&gt;</span></span>
<span><span class="co">#&gt; 1        ko15           KO /usr/local...          QC</span></span>
<span><span class="co">#&gt; 2        ko16           KO /usr/local...       study</span></span>
<span><span class="co">#&gt; 3        ko21           KO /usr/local...       study</span></span>
<span><span class="co">#&gt; 4        ko22           KO /usr/local...          QC</span></span>
<span><span class="co">#&gt; 5        wt15           WT /usr/local...       study</span></span>
<span><span class="co">#&gt; 6        wt16           WT /usr/local...       study</span></span>
<span><span class="co">#&gt; 7        wt21           WT /usr/local...          QC</span></span>
<span><span class="co">#&gt; 8        wt22           WT /usr/local...       study</span></span>
<span></span>
<span><span class="co"># Check results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Dataset contains"</span>, <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-class.html" class="external-link">chromPeaks</a></span><span class="op">(</span><span class="va">xdata</span><span class="op">)</span><span class="op">)</span>, <span class="st">"peaks across"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-class.html" class="external-link">chromPeaks</a></span><span class="op">(</span><span class="va">xdata</span><span class="op">)</span><span class="op">[</span>, <span class="st">"sample"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, <span class="st">"samples,"</span>,</span>
<span>    <span class="st">"grouped into"</span>, <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-class.html" class="external-link">featureDefinitions</a></span><span class="op">(</span><span class="va">xdata</span><span class="op">)</span><span class="op">)</span>, <span class="st">"features\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Dataset contains 3651 peaks across 8 samples, grouped into 351 features</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-long-format-peak-table-without-camera">Create Long-Format Peak Table (Without CAMERA)<a class="anchor" aria-label="anchor" href="#create-long-format-peak-table-without-camera"></a>
</h3>
<p>You can create a long-format peak table directly from the XCMS
results without using CAMERA annotations. This is useful when you want
to quickly explore your data or when CAMERA annotations are not needed
for your analysis.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create peak table without CAMERA</span></span>
<span><span class="va">peak_table_no_camera</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/XCMSnExp_CAMERA_peaklist_long.html">XCMSnExp_CAMERA_peaklist_long</a></span><span class="op">(</span><span class="va">xdata</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check the structure</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">peak_table_no_camera</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2808   28</span></span>
<span></span>
<span><span class="co"># View first few rows</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">peak_table_no_camera</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 28</span></span></span>
<span><span class="co">#&gt;   sample_name sample_group spectraOrigin sample_type fromFile feature_id f_mzmed</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ko15        KO           /usr/local/l… QC                 1          1    200.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ko15        KO           /usr/local/l… QC                 1          2    205 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ko15        KO           /usr/local/l… QC                 1          3    206 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ko15        KO           /usr/local/l… QC                 1          4    207.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ko15        KO           /usr/local/l… QC                 1          5    233 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ko15        KO           /usr/local/l… QC                 1          6    241.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 21 more variables: f_mzmin &lt;dbl&gt;, f_mzmax &lt;dbl&gt;, f_rtmed &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   f_rtmin &lt;dbl&gt;, f_rtmax &lt;dbl&gt;, ms_level &lt;int&gt;, filepath &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   filename &lt;chr&gt;, peakidx &lt;dbl&gt;, mz &lt;dbl&gt;, mzmin &lt;dbl&gt;, mzmax &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   rt &lt;dbl&gt;, rtmin &lt;dbl&gt;, rtmax &lt;dbl&gt;, into &lt;dbl&gt;, intb &lt;dbl&gt;, maxo &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   sn &lt;dbl&gt;, is_filled &lt;lgl&gt;, merged &lt;lgl&gt;</span></span></span>
<span></span>
<span><span class="co"># Check column names - note that isotopes, adduct, and pcgroup are NOT present</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">peak_table_no_camera</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "sample_name"   "sample_group"  "spectraOrigin" "sample_type"  </span></span>
<span><span class="co">#&gt;  [5] "fromFile"      "feature_id"    "f_mzmed"       "f_mzmin"      </span></span>
<span><span class="co">#&gt;  [9] "f_mzmax"       "f_rtmed"       "f_rtmin"       "f_rtmax"      </span></span>
<span><span class="co">#&gt; [13] "ms_level"      "filepath"      "filename"      "peakidx"      </span></span>
<span><span class="co">#&gt; [17] "mz"            "mzmin"         "mzmax"         "rt"           </span></span>
<span><span class="co">#&gt; [21] "rtmin"         "rtmax"         "into"          "intb"         </span></span>
<span><span class="co">#&gt; [25] "maxo"          "sn"            "is_filled"     "merged"</span></span></code></pre></div>
<p>The resulting table contains all feature and peak information. The
CAMERA annotation columns (<code>isotopes</code>, <code>adduct</code>,
<code>pcgroup</code>) are <strong>not included</strong> when no CAMERA
annotations are provided, keeping the output cleaner and more
memory-efficient.</p>
</div>
<div class="section level3">
<h3 id="camera-annotation-optional">CAMERA Annotation (Optional)<a class="anchor" aria-label="anchor" href="#camera-annotation-optional"></a>
</h3>
<p>Use CAMERA to annotate isotopes, adducts, and group features into
pseudospectra.</p>
<p><strong>Note:</strong> CAMERA requires an <code>xcmsSet</code>
object. Since our data is an <code>XcmsExperiment</code>, we first
convert it to <code>XCMSnExp</code> and then to
<code>xcmsSet</code>.</p>
<div class="section level4">
<h4 id="creating-a-camera-object">Creating a CAMERA object<a class="anchor" aria-label="anchor" href="#creating-a-camera-object"></a>
</h4>
<p>In this first step we create a CAMERA object from the XCMS object. We
specify the polarity to help CAMERA determine appropriate adducts and
fragments.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert XcmsExperiment to xcmsSet for CAMERA (required for compatibility)</span></span>
<span><span class="co"># Two-step conversion: XcmsExperiment -&gt; XCMSnExp -&gt; xcmsSet</span></span>
<span><span class="va">xset</span> <span class="op">&lt;-</span> <span class="va">xdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="st">"XCMSnExp"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="st">"xcmsSet"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create xsAnnotate object with polarity</span></span>
<span><span class="va">xs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CAMERA/man/xsAnnotate.html" class="external-link">xsAnnotate</a></span><span class="op">(</span><span class="va">xset</span>, polarity <span class="op">=</span> <span class="st">"positive"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="grouping-coeluting-peaks">Grouping coeluting peaks<a class="anchor" aria-label="anchor" href="#grouping-coeluting-peaks"></a>
</h4>
<p>The first step to grouping features is to group co-eluting peaks.
This is a naïve approach that we will refine later.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Group peaks by retention time</span></span>
<span><span class="va">xs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CAMERA/man/groupFWHM-methods.html" class="external-link">groupFWHM</a></span><span class="op">(</span><span class="va">xs</span>, perfwhm <span class="op">=</span> <span class="fl">0.1</span>, intval <span class="op">=</span> <span class="st">"into"</span>, sigma <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="co">#&gt; Start grouping after retention time.</span></span>
<span><span class="co">#&gt; Created 226 pseudospectra.</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="grouping-based-on-correlation">Grouping based on correlation<a class="anchor" aria-label="anchor" href="#grouping-based-on-correlation"></a>
</h4>
<p>Now we group the features based on correlations. This looks at each
group from the previous step and splits them into separate groups for
peaks that correlate with each other.</p>
<p><strong>Note:</strong> For this small example dataset, don’t use
correlation across samples as it is unreliable with this few
samples.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Group by correlation</span></span>
<span><span class="va">xs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CAMERA/man/groupCorr-methods.html" class="external-link">groupCorr</a></span><span class="op">(</span><span class="va">xs</span>, calcIso <span class="op">=</span> <span class="cn">FALSE</span>, calcCiS <span class="op">=</span> <span class="cn">TRUE</span>, calcCaS <span class="op">=</span> <span class="cn">FALSE</span>, cor_eic_th <span class="op">=</span> <span class="fl">0.7</span>, pval <span class="op">=</span> <span class="fl">1E-6</span><span class="op">)</span></span>
<span><span class="co">#&gt; Start grouping after correlation.</span></span>
<span><span class="co">#&gt; Generating EIC's .. </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Calculating peak correlations in 226 Groups... </span></span>
<span><span class="co">#&gt;  % finished: 10  20  30  40  50  60  70  80  90  100  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Calculating graph cross linking in 226 Groups... </span></span>
<span><span class="co">#&gt;  % finished: 10  20  30  40  50  60  70  80  90  100  </span></span>
<span><span class="co">#&gt; New number of ps-groups:  271 </span></span>
<span><span class="co">#&gt; xsAnnotate has now 271 groups, instead of 226</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="isotope-annotation">Isotope annotation<a class="anchor" aria-label="anchor" href="#isotope-annotation"></a>
</h4>
<p>This annotates peaks that are possible isotopes based on m/z
difference and intensity patterns.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Find isotopes</span></span>
<span><span class="va">xs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CAMERA/man/findIsotopes-methods.html" class="external-link">findIsotopes</a></span><span class="op">(</span><span class="va">xs</span>, ppm <span class="op">=</span> <span class="fl">10</span>, mzabs <span class="op">=</span> <span class="fl">0.01</span>, intval <span class="op">=</span> <span class="st">"into"</span>, maxcharge <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Generating peak matrix!</span></span>
<span><span class="co">#&gt; Run isotope peak annotation</span></span>
<span><span class="co">#&gt;  % finished: 10  20  30  40  50  60  70  80  90  100  </span></span>
<span><span class="co">#&gt; Found isotopes: 29</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="annotation-of-adducts-and-fragments">Annotation of adducts and fragments<a class="anchor" aria-label="anchor" href="#annotation-of-adducts-and-fragments"></a>
</h4>
<p>Now we try to annotate adducts and fragments based on expected mass
differences. We’ll use the <code>commonMZ</code> package to generate a
comprehensive list of adduct and fragment rules for CAMERA.</p>
<p>First, we get the adduct/fragment rules for positive mode:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># warn_clash=TRUE will warn about indistinguishable annotations (e.g., [M+NH4]+ vs -NH3)</span></span>
<span><span class="co"># Remove [M+NH4]+ if it's less common in your data</span></span>
<span></span>
<span><span class="va">rules_pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/commonMZ/man/MZ_CAMERA.html" class="external-link">MZ_CAMERA</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"pos"</span>, warn_clash <span class="op">=</span> <span class="cn">TRUE</span>, clash_ppm <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">!=</span> <span class="st">"[M+NH4]+"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in MZ_CAMERA(mode = "pos", warn_clash = TRUE, clash_ppm = 5): The following adducts/fragments seem to collide.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;   first       second                             </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> [M+H-NH3]+  [M+NH4]+                           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> [M+H-C3H4]+ [M+H+(CH3)2CO-H2O]+ (acetone cond.)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Consider removing one of them. Example: </span></span>
<span><span class="co">#&gt;  rules=rules[            !grepl("[M+NH4]+",rules[,"name"],fixed=TRUE)         ,]</span></span></code></pre></div>
<p>Now we can annotate adducts using these rules:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Find adducts using the rules from commonMZ</span></span>
<span><span class="va">xs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CAMERA/man/findAdducts-methods.html" class="external-link">findAdducts</a></span><span class="op">(</span><span class="va">xs</span>, ppm <span class="op">=</span> <span class="fl">500</span>, mzabs <span class="op">=</span> <span class="fl">0.2</span>, multiplier <span class="op">=</span> <span class="fl">4</span>, polarity <span class="op">=</span> <span class="st">"positive"</span>, rules <span class="op">=</span> <span class="va">rules_pos</span><span class="op">)</span></span>
<span><span class="co">#&gt; Generating peak matrix for peak annotation!</span></span>
<span><span class="co">#&gt; Polarity is set in xsAnnotate: positive </span></span>
<span><span class="co">#&gt; Found and use user-defined ruleset!</span></span>
<span><span class="co">#&gt; Calculating possible adducts in 271 Groups... </span></span>
<span><span class="co">#&gt;  % finished: 10  20  30  40  50  60  70  80  90  100</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="create-long-format-peak-table">Create Long-Format Peak Table<a class="anchor" aria-label="anchor" href="#create-long-format-peak-table"></a>
</h3>
<p>Now we can create our comprehensive long-format peak table! Note that
we use the original <code>xdata</code> (XCMSnExp) object along with the
CAMERA annotations from <code>xs</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">peak_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/XCMSnExp_CAMERA_peaklist_long.html">XCMSnExp_CAMERA_peaklist_long</a></span><span class="op">(</span><span class="va">xdata</span>, <span class="va">xs</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check the structure</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">peak_table</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2808   31</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">peak_table</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "sample_name"   "sample_group"  "spectraOrigin" "sample_type"  </span></span>
<span><span class="co">#&gt;  [5] "fromFile"      "feature_id"    "f_mzmed"       "f_mzmin"      </span></span>
<span><span class="co">#&gt;  [9] "f_mzmax"       "f_rtmed"       "f_rtmin"       "f_rtmax"      </span></span>
<span><span class="co">#&gt; [13] "isotopes"      "adduct"        "pcgroup"       "ms_level"     </span></span>
<span><span class="co">#&gt; [17] "filepath"      "filename"      "peakidx"       "mz"           </span></span>
<span><span class="co">#&gt; [21] "mzmin"         "mzmax"         "rt"            "rtmin"        </span></span>
<span><span class="co">#&gt; [25] "rtmax"         "into"          "intb"          "maxo"         </span></span>
<span><span class="co">#&gt; [29] "sn"            "is_filled"     "merged"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="understanding-the-output">Understanding the Output<a class="anchor" aria-label="anchor" href="#understanding-the-output"></a>
</h2>
<p>The resulting tibble contains comprehensive information about each
feature in each sample. Below is a complete description of all
columns:</p>
<div class="section level3">
<h3 id="column-reference-table">Column Reference Table<a class="anchor" aria-label="anchor" href="#column-reference-table"></a>
</h3>
<p>The table has been organized into logical groups for easier
understanding:</p>
<table class="table">
<colgroup>
<col width="47%">
<col width="52%">
</colgroup>
<thead><tr class="header">
<th>Column</th>
<th>Content</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Sample information</strong></td>
<td></td>
</tr>
<tr class="even">
<td><code>filepath</code></td>
<td>Path to the raw data file</td>
</tr>
<tr class="odd">
<td><code>filename</code></td>
<td>The filename without path</td>
</tr>
<tr class="even">
<td><code>fromFile</code></td>
<td>The file number (the order files were supplied in)</td>
</tr>
<tr class="odd">
<td><em>Plus any columns from <code><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData()</a></code></em></td>
<td>Sample metadata columns (e.g., sample_name, sample_group,
sample_type)</td>
</tr>
<tr class="even">
<td><strong>Feature identifiers</strong></td>
<td></td>
</tr>
<tr class="odd">
<td><code>feature_id</code></td>
<td>The index of the feature after grouping across samples</td>
</tr>
<tr class="even">
<td><code>peakidx</code></td>
<td>The index of the peak before grouping across samples</td>
</tr>
<tr class="odd">
<td><strong>Feature-level m/z statistics (across all
samples)</strong></td>
<td></td>
</tr>
<tr class="even">
<td><code>f_mzmed</code></td>
<td>The median m/z found for that feature <strong>across
samples</strong>
</td>
</tr>
<tr class="odd">
<td><code>f_mzmin</code></td>
<td>The minimum m/z found for that feature across samples</td>
</tr>
<tr class="even">
<td><code>f_mzmax</code></td>
<td>The maximum m/z found for that feature across samples</td>
</tr>
<tr class="odd">
<td><strong>Feature-level retention time statistics (across all
samples)</strong></td>
<td></td>
</tr>
<tr class="even">
<td><code>f_rtmed</code></td>
<td>The median retention time found for that feature across samples</td>
</tr>
<tr class="odd">
<td><code>f_rtmin</code></td>
<td>The minimum retention time found for that feature across
samples</td>
</tr>
<tr class="even">
<td><code>f_rtmax</code></td>
<td>The maximum retention time found for that feature across
samples</td>
</tr>
<tr class="odd">
<td><strong>CAMERA annotations</strong></td>
<td></td>
</tr>
<tr class="even">
<td><code>isotopes</code></td>
<td>The isotope annotation from CAMERA (e.g., “[M]+”, “[M+1]+”,
“[M+2]+”)</td>
</tr>
<tr class="odd">
<td><code>adduct</code></td>
<td>The adduct annotation from CAMERA (e.g., “[M+H]+”, “[M+Na]+”,
“[M+NH4]+”)</td>
</tr>
<tr class="even">
<td><code>pcgroup</code></td>
<td>The feature grouping index from CAMERA - features with same ID
likely come from the same compound</td>
</tr>
<tr class="odd">
<td><strong>Peak-level m/z measurements (in that specific
sample)</strong></td>
<td></td>
</tr>
<tr class="even">
<td><code>mz</code></td>
<td>The median m/z found for that feature in <strong>that
sample</strong>
</td>
</tr>
<tr class="odd">
<td><code>mzmin</code></td>
<td>The minimum m/z found for that feature in that sample</td>
</tr>
<tr class="even">
<td><code>mzmax</code></td>
<td>The maximum m/z found for that feature in that sample</td>
</tr>
<tr class="odd">
<td><strong>Peak-level retention time measurements (in that specific
sample)</strong></td>
<td></td>
</tr>
<tr class="even">
<td><code>rt</code></td>
<td>The retention time found for that feature in that sample</td>
</tr>
<tr class="odd">
<td><code>rtmin</code></td>
<td>The minimum retention time found for that feature in that
sample</td>
</tr>
<tr class="even">
<td><code>rtmax</code></td>
<td>The maximum retention time found for that feature in that
sample</td>
</tr>
<tr class="odd">
<td><strong>Peak intensity measurements</strong></td>
<td></td>
</tr>
<tr class="even">
<td><code>into</code></td>
<td>The area under the peak</td>
</tr>
<tr class="odd">
<td><code>intb</code></td>
<td>The area under the peak after baseline removal</td>
</tr>
<tr class="even">
<td><code>maxo</code></td>
<td>The maximum intensity (i.e., height) of the peak</td>
</tr>
<tr class="odd">
<td><code>sn</code></td>
<td>The signal to noise ratio of that peak</td>
</tr>
<tr class="even">
<td><strong>Gaussian peak fitting parameters</strong></td>
<td></td>
</tr>
<tr class="odd">
<td><code>egauss</code></td>
<td>RMSE of Gaussian fit</td>
</tr>
<tr class="even">
<td><code>mu</code></td>
<td>Gaussian parameter mu (center of the Gaussian; unit is scan
number)</td>
</tr>
<tr class="odd">
<td><code>sigma</code></td>
<td>Gaussian parameter sigma</td>
</tr>
<tr class="even">
<td><code>h</code></td>
<td>Gaussian parameter h (height of the Gaussian peak)</td>
</tr>
<tr class="odd">
<td><strong>CentWave algorithm parameters</strong></td>
<td></td>
</tr>
<tr class="even">
<td><code>f</code></td>
<td>Region number of m/z ROI where the peak was localized</td>
</tr>
<tr class="odd">
<td><code>dppm</code></td>
<td>m/z deviation of mass trace across scans in ppm</td>
</tr>
<tr class="even">
<td><code>scale</code></td>
<td>Scale on which the peak was localized</td>
</tr>
<tr class="odd">
<td><code>scpos</code></td>
<td>Center of peak position found by wavelet analysis</td>
</tr>
<tr class="even">
<td><code>scmin</code></td>
<td>Left peak limit found by wavelet analysis (scan number)</td>
</tr>
<tr class="odd">
<td><code>scmax</code></td>
<td>Right peak limit found by wavelet analysis (scan number)</td>
</tr>
<tr class="even">
<td><strong>Additional columns</strong></td>
<td></td>
</tr>
<tr class="odd">
<td><code>ms_level</code></td>
<td>MS level (e.g., MS1, MS2)</td>
</tr>
<tr class="even">
<td><code>is_filled</code></td>
<td>Was the intensity found by gap filling (TRUE) or peak picking
(FALSE)</td>
</tr>
</tbody>
</table>
<p><strong>Important notes:</strong></p>
<ul>
<li><strong>Each row represents one feature in one sample</strong></li>
<li>If a feature was not detected in a sample, peak-level columns (mz,
rt, into, etc.) will be <code>NA</code>
</li>
<li>Feature-level statistics (f_mzmed, f_rtmed, etc.) are always present
and represent values across all samples</li>
<li>CAMERA annotations apply at the feature level and are the same
across all samples for a given feature</li>
<li>The distinction between “feature-level” and “peak-level” is
important:
<ul>
<li>
<strong>Feature-level</strong> (prefix <code>f_</code>): Statistics
aggregated across all samples</li>
<li>
<strong>Peak-level</strong> (no prefix): Values for the specific
peak in that specific sample</li>
</ul>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="feature-level-information">Feature-Level Information<a class="anchor" aria-label="anchor" href="#feature-level-information"></a>
</h3>
<p>These columns describe each feature (grouped peak):</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">peak_table</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">feature_id</span>, <span class="va">f_mzmed</span>, <span class="va">f_rtmed</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   feature_id f_mzmed f_rtmed</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>          1    200.   <span style="text-decoration: underline;">2</span>903.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>          2    205    <span style="text-decoration: underline;">2</span>790.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>          3    206    <span style="text-decoration: underline;">2</span>789.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>          4    207.   <span style="text-decoration: underline;">2</span>719.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>          5    233    <span style="text-decoration: underline;">3</span>024.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>          6    241.   <span style="text-decoration: underline;">3</span>683.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="camera-annotations">CAMERA Annotations<a class="anchor" aria-label="anchor" href="#camera-annotations"></a>
</h3>
<ul>
<li>
<code>isotopes</code>: Isotope annotation (e.g., “[M]+”,
“[M+1]+”)</li>
<li>
<code>adduct</code>: Adduct annotation (e.g., “[M+H]+”,
“[M+Na]+”)</li>
<li>
<code>pcgroup</code>: Pseudospectrum correlation group ID</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View features with adduct annotations</span></span>
<span><span class="va">peak_table</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">adduct</span><span class="op">!=</span><span class="st">""</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">feature_id</span>, <span class="va">f_mzmed</span>, <span class="va">f_rtmed</span>, <span class="va">isotopes</span>, <span class="va">adduct</span>, <span class="va">pcgroup</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">feature_id</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;   feature_id f_mzmed f_rtmed isotopes  adduct                            pcgroup</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                               <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>          3    206    <span style="text-decoration: underline;">2</span>789. <span style="color: #949494;">""</span>        [M+2K]2+ 334.047 [M+H-NH3-CO2-C5…      11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>          6    241.   <span style="text-decoration: underline;">3</span>683. <span style="color: #949494;">""</span>        [M+H-S]+ 272.112 [M+H-CH3OH]+ 27…      87</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>         11    255.   <span style="text-decoration: underline;">3</span>682. <span style="color: #949494;">""</span>        [M+H-H2O]+ 272.112                     87</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>         13    266.   <span style="text-decoration: underline;">3</span>669. <span style="color: #949494;">""</span>        [M+H-C2H4-CO2]+ 337.215 [M+H-C4H…      44</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>         19    279    <span style="text-decoration: underline;">2</span>788. <span style="color: #949494;">""</span>        [M+H-C3H4O]+ 334.047 [M+H-C4H8]+…      11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>         21    281.   <span style="text-decoration: underline;">3</span>669. <span style="color: #949494;">"</span>[1][M]+<span style="color: #949494;">"</span> [M+H-NH3-C3H4]+ 337.215                44</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="peak-level-information">Peak-Level Information<a class="anchor" aria-label="anchor" href="#peak-level-information"></a>
</h3>
<p>For each feature in each sample:</p>
<ul>
<li>
<code>mz</code>, <code>rt</code>: Detected peak position</li>
<li>
<code>into</code>: Integrated peak intensity</li>
<li>
<code>intb</code>: Baseline-corrected intensity</li>
<li>
<code>maxo</code>: Maximum intensity</li>
<li>
<code>sn</code>: Signal-to-noise ratio</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View detected peaks (non-NA intensities)</span></span>
<span><span class="va">peak_table</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">into</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">feature_id</span>, <span class="va">filename</span>, <span class="va">mz</span>, <span class="va">rt</span>, <span class="va">into</span>, <span class="va">sn</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;   feature_id filename    mz    rt     into    sn</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>          1 ko15.CDF  200. <span style="text-decoration: underline;">2</span>933.  <span style="text-decoration: underline;">135</span>162.    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>          2 ko15.CDF  205  <span style="text-decoration: underline;">2</span>792. 1<span style="text-decoration: underline;">924</span>712.    64</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>          3 ko15.CDF  206  <span style="text-decoration: underline;">2</span>790.  <span style="text-decoration: underline;">213</span>659.    14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>          4 ko15.CDF  207. <span style="text-decoration: underline;">2</span>718.  <span style="text-decoration: underline;">349</span>011.    17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>          5 ko15.CDF  233  <span style="text-decoration: underline;">3</span>035.  <span style="text-decoration: underline;">286</span>221.    23</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>          6 ko15.CDF  241. <span style="text-decoration: underline;">3</span>681. 1<span style="text-decoration: underline;">160</span>580.    11</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="sample-information">Sample Information<a class="anchor" aria-label="anchor" href="#sample-information"></a>
</h3>
<ul>
<li>
<code>filename</code>, <code>filepath</code>: Sample file
information</li>
<li>
<code>fromFile</code>: Sample index</li>
<li>Plus any columns from <code><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData()</a></code> (sample
metadata)</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">peak_table</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">feature_id</span>, <span class="va">filename</span>, <span class="va">sample_name</span>, <span class="va">sample_group</span>, <span class="va">sample_type</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">#&gt;   feature_id filename sample_name sample_group sample_type</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>          1 ko15.CDF ko15        KO           QC         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>          2 ko15.CDF ko15        KO           QC         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>          3 ko15.CDF ko15        KO           QC         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>          4 ko15.CDF ko15        KO           QC         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>          5 ko15.CDF ko15        KO           QC         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>          6 ko15.CDF ko15        KO           QC</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="missing-values">Missing Values<a class="anchor" aria-label="anchor" href="#missing-values"></a>
</h3>
<p>Features not detected in a sample have <code>NA</code> for peak-level
columns:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Count detected features per sample</span></span>
<span><span class="va">peak_table</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">filename</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    n_features_detected <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">into</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    n_features_total <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 3</span></span></span>
<span><span class="co">#&gt;   filename n_features_detected n_features_total</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ko15.CDF                 350              351</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ko16.CDF                 350              351</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ko21.CDF                 350              351</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ko22.CDF                 349              351</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> wt15.CDF                 348              351</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> wt16.CDF                 347              351</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> wt21.CDF                 348              351</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> wt22.CDF                 351              351</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="downstream-analysis-examples">Downstream Analysis Examples<a class="anchor" aria-label="anchor" href="#downstream-analysis-examples"></a>
</h2>
<div class="section level3">
<h3 id="visualize-feature-intensities">Visualize Feature Intensities<a class="anchor" aria-label="anchor" href="#visualize-feature-intensities"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot intensity distribution by sample group</span></span>
<span><span class="va">peak_table</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">feature_id</span> <span class="op">==</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sample_group</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">into</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">sample_group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Feature Intensity Distribution"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Sample Group"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"log10(Intensity)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="long-format-peaklist_files/figure-html/plot_intensities-1.png" class="r-plt" alt="Boxplot showing the distribution of log10-transformed feature intensities across sample groups. The plot displays the median, quartiles, and outliers for each group." width="672"></p>
</div>
<div class="section level3">
<h3 id="identify-features-with-adduct-annotations">Identify Features with Adduct Annotations<a class="anchor" aria-label="anchor" href="#identify-features-with-adduct-annotations"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Count features by adduct type</span></span>
<span><span class="va">adduct_counts</span> <span class="op">&lt;-</span> <span class="va">peak_table</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">adduct</span><span class="op">!=</span><span class="st">""</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_rows.html" class="external-link">separate_rows</a></span><span class="op">(</span><span class="va">adduct</span>, sep <span class="op">=</span> <span class="st">"\\s(?=\\[M)"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">feature_id</span>, <span class="va">adduct</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>adduct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"^(\\[.*\\].*\\+).*"</span>,<span class="st">"\\1"</span>,<span class="va">adduct</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">adduct</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adduct_counts</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 33 × 2</span></span></span>
<span><span class="co">#&gt;    adduct                  n</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> [M+H]+                 12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> [M+Na]+                12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> [M+H-H2O]+             10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> [M+K]+                  6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> [M+H-C3H9N-C2H4O2]+     5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> [M+H-CH4]+              5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> [M+H-O]+                5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> [M+H-NH3]+              4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> [M+H-CH3OH]+            3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> [M+H-S]+                3</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 23 more rows</span></span></span></code></pre></div>
<div class="section level4">
<h4 id="visualize-adduct-distribution">Visualize Adduct Distribution<a class="anchor" aria-label="anchor" href="#visualize-adduct-distribution"></a>
</h4>
<p>We can create a pie chart showing the frequency of different adducts
and fragments found by CAMERA:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create pie chart of adduct frequencies</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/pie.html" class="external-link">pie</a></span><span class="op">(</span><span class="va">adduct_counts</span><span class="op">$</span><span class="va">n</span>, labels <span class="op">=</span> <span class="va">adduct_counts</span><span class="op">$</span><span class="va">adduct</span>, main <span class="op">=</span> <span class="st">"Distribution of Adduct Annotations"</span><span class="op">)</span></span></code></pre></div>
<p><img src="long-format-peaklist_files/figure-html/adduct_pie-1.png" class="r-plt" alt="Pie chart showing the distribution of adduct and fragment annotations found by CAMERA across all features." width="672"></p>
</div>
</div>
<div class="section level3">
<h3 id="find-features-present-in-all-samples">Find Features Present in All Samples<a class="anchor" aria-label="anchor" href="#find-features-present-in-all-samples"></a>
</h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Features detected in all samples</span></span>
<span><span class="va">complete_features</span> <span class="op">&lt;-</span> <span class="va">peak_table</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">feature_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    n_detected <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">into</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    n_samples <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n_detected</span> <span class="op">==</span> <span class="va">n_samples</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Found"</span>, <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">complete_features</span><span class="op">)</span>, <span class="st">"features detected in all samples\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Found 345 features detected in all samples</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="coefficient-of-variation-analysis">Coefficient of Variation Analysis<a class="anchor" aria-label="anchor" href="#coefficient-of-variation-analysis"></a>
</h3>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate CV for each feature</span></span>
<span><span class="va">feature_cv</span> <span class="op">&lt;-</span> <span class="va">peak_table</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">into</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">feature_id</span>, <span class="va">f_mzmed</span>, <span class="va">f_rtmed</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    mean_intensity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">into</span><span class="op">)</span>,</span>
<span>    sd_intensity <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">into</span><span class="op">)</span>,</span>
<span>    cv <span class="op">=</span> <span class="va">sd_intensity</span> <span class="op">/</span> <span class="va">mean_intensity</span> <span class="op">*</span> <span class="fl">100</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">cv</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show most stable features</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">feature_cv</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;   feature_id f_mzmed f_rtmed mean_intensity sd_intensity    cv</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>         75    338.   <span style="text-decoration: underline;">3</span>026.        <span style="text-decoration: underline;">425</span>823.       <span style="text-decoration: underline;">33</span>850.  7.95</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>        237    498.   <span style="text-decoration: underline;">3</span>432.       1<span style="text-decoration: underline;">608</span>474.      <span style="text-decoration: underline;">195</span>924. 12.2 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>        185    438.   <span style="text-decoration: underline;">3</span>464.       2<span style="text-decoration: underline;">151</span>297.      <span style="text-decoration: underline;">280</span>666. 13.0 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>        261    523.   <span style="text-decoration: underline;">3</span>405.       6<span style="text-decoration: underline;">295</span>635.      <span style="text-decoration: underline;">879</span>251. 14.0 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>        113    365    <span style="text-decoration: underline;">2</span>687.      13<span style="text-decoration: underline;">311</span>820.     1<span style="text-decoration: underline;">922</span>776. 14.4 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>        157    404.   <span style="text-decoration: underline;">2</span>695.        <span style="text-decoration: underline;">324</span>147.       <span style="text-decoration: underline;">46</span>898. 14.5</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="extract-specific-features-for-further-analysis">Extract Specific Features for Further Analysis<a class="anchor" aria-label="anchor" href="#extract-specific-features-for-further-analysis"></a>
</h3>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get a specific feature across all samples</span></span>
<span><span class="va">feature_123</span> <span class="op">&lt;-</span> <span class="va">peak_table</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">feature_id</span> <span class="op">==</span> <span class="fl">123</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">feature_id</span>, <span class="va">filename</span>, <span class="va">sample_group</span>, <span class="va">mz</span>, <span class="va">rt</span>, <span class="va">into</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">feature_123</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;   feature_id filename sample_group    mz    rt    into</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>        123 ko15.CDF KO            371. <span style="text-decoration: underline;">3</span>657. <span style="text-decoration: underline;">563</span>419.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>        123 ko16.CDF KO            371. <span style="text-decoration: underline;">3</span>657. <span style="text-decoration: underline;">320</span>434.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>        123 ko21.CDF KO            371. <span style="text-decoration: underline;">3</span>649. <span style="text-decoration: underline;">123</span>876.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>        123 ko22.CDF KO            371. <span style="text-decoration: underline;">3</span>633. <span style="text-decoration: underline;">173</span>440.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>        123 wt15.CDF WT            371. <span style="text-decoration: underline;">3</span>632. <span style="text-decoration: underline;">570</span>454.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>        123 wt16.CDF WT            371. <span style="text-decoration: underline;">3</span>639. <span style="text-decoration: underline;">287</span>139.</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.2 (2025-10-31)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 24.04.3 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">#&gt; [8] base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt;  [1] MsExperiment_1.12.0 tidyr_1.3.1         ggplot2_4.0.0      </span></span>
<span><span class="co">#&gt;  [4] dplyr_1.1.4         commonMZ_0.0.2      CAMERA_1.66.0      </span></span>
<span><span class="co">#&gt;  [7] MSnbase_2.36.0      ProtGenerics_1.42.0 S4Vectors_0.48.0   </span></span>
<span><span class="co">#&gt; [10] mzR_2.44.0          Rcpp_1.1.0          Biobase_2.70.0     </span></span>
<span><span class="co">#&gt; [13] BiocGenerics_0.56.0 generics_0.1.4      xcms_4.8.0         </span></span>
<span><span class="co">#&gt; [16] BiocParallel_1.44.0 tidyXCMS_0.99.6    </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;   [1] RColorBrewer_1.1-3          rstudioapi_0.17.1          </span></span>
<span><span class="co">#&gt;   [3] jsonlite_2.0.0              MultiAssayExperiment_1.36.0</span></span>
<span><span class="co">#&gt;   [5] magrittr_2.0.4              farver_2.1.2               </span></span>
<span><span class="co">#&gt;   [7] MALDIquant_1.22.3           rmarkdown_2.30             </span></span>
<span><span class="co">#&gt;   [9] fs_1.6.6                    ragg_1.5.0                 </span></span>
<span><span class="co">#&gt;  [11] vctrs_0.6.5                 base64enc_0.1-3            </span></span>
<span><span class="co">#&gt;  [13] htmltools_0.5.8.1           S4Arrays_1.10.0            </span></span>
<span><span class="co">#&gt;  [15] BiocBaseUtils_1.12.0        progress_1.2.3             </span></span>
<span><span class="co">#&gt;  [17] cellranger_1.1.0            SparseArray_1.10.1         </span></span>
<span><span class="co">#&gt;  [19] Formula_1.2-5               mzID_1.48.0                </span></span>
<span><span class="co">#&gt;  [21] sass_0.4.10                 bslib_0.9.0                </span></span>
<span><span class="co">#&gt;  [23] htmlwidgets_1.6.4           desc_1.4.3                 </span></span>
<span><span class="co">#&gt;  [25] plyr_1.8.9                  impute_1.84.0              </span></span>
<span><span class="co">#&gt;  [27] cachem_1.1.0                igraph_2.2.1               </span></span>
<span><span class="co">#&gt;  [29] lifecycle_1.0.4             iterators_1.0.14           </span></span>
<span><span class="co">#&gt;  [31] pkgconfig_2.0.3             Matrix_1.7-4               </span></span>
<span><span class="co">#&gt;  [33] R6_2.6.1                    fastmap_1.2.0              </span></span>
<span><span class="co">#&gt;  [35] MatrixGenerics_1.22.0       clue_0.3-66                </span></span>
<span><span class="co">#&gt;  [37] digest_0.6.37               pcaMethods_2.2.0           </span></span>
<span><span class="co">#&gt;  [39] colorspace_2.1-2            textshaping_1.0.4          </span></span>
<span><span class="co">#&gt;  [41] Hmisc_5.2-4                 GenomicRanges_1.62.0       </span></span>
<span><span class="co">#&gt;  [43] labeling_0.4.3              Spectra_1.20.0             </span></span>
<span><span class="co">#&gt;  [45] abind_1.4-8                 compiler_4.5.2             </span></span>
<span><span class="co">#&gt;  [47] withr_3.0.2                 bit64_4.6.0-1              </span></span>
<span><span class="co">#&gt;  [49] doParallel_1.0.17           htmlTable_2.4.3            </span></span>
<span><span class="co">#&gt;  [51] S7_0.2.0                    backports_1.5.0            </span></span>
<span><span class="co">#&gt;  [53] DBI_1.2.3                   MASS_7.3-65                </span></span>
<span><span class="co">#&gt;  [55] DelayedArray_0.36.0         tools_4.5.2                </span></span>
<span><span class="co">#&gt;  [57] PSMatch_1.14.0              foreign_0.8-90             </span></span>
<span><span class="co">#&gt;  [59] nnet_7.3-20                 glue_1.8.0                 </span></span>
<span><span class="co">#&gt;  [61] QFeatures_1.20.0            grid_4.5.2                 </span></span>
<span><span class="co">#&gt;  [63] checkmate_2.3.3             cluster_2.1.8.1            </span></span>
<span><span class="co">#&gt;  [65] reshape2_1.4.4              gtable_0.3.6               </span></span>
<span><span class="co">#&gt;  [67] tzdb_0.5.0                  preprocessCore_1.72.0      </span></span>
<span><span class="co">#&gt;  [69] data.table_1.17.8           hms_1.1.4                  </span></span>
<span><span class="co">#&gt;  [71] MetaboCoreUtils_1.18.0      utf8_1.2.6                 </span></span>
<span><span class="co">#&gt;  [73] XVector_0.50.0              foreach_1.5.2              </span></span>
<span><span class="co">#&gt;  [75] pillar_1.11.1               stringr_1.6.0              </span></span>
<span><span class="co">#&gt;  [77] vroom_1.6.6                 limma_3.66.0               </span></span>
<span><span class="co">#&gt;  [79] lattice_0.22-7              bit_4.6.0                  </span></span>
<span><span class="co">#&gt;  [81] tidyselect_1.2.1            RBGL_1.86.0                </span></span>
<span><span class="co">#&gt;  [83] knitr_1.50                  gridExtra_2.3              </span></span>
<span><span class="co">#&gt;  [85] IRanges_2.44.0              Seqinfo_1.0.0              </span></span>
<span><span class="co">#&gt;  [87] SummarizedExperiment_1.40.0 xfun_0.54                  </span></span>
<span><span class="co">#&gt;  [89] statmod_1.5.1               matrixStats_1.5.0          </span></span>
<span><span class="co">#&gt;  [91] stringi_1.8.7               lazyeval_0.2.2             </span></span>
<span><span class="co">#&gt;  [93] yaml_2.3.10                 evaluate_1.0.5             </span></span>
<span><span class="co">#&gt;  [95] codetools_0.2-20            MsCoreUtils_1.21.0         </span></span>
<span><span class="co">#&gt;  [97] tibble_3.3.0                BiocManager_1.30.26        </span></span>
<span><span class="co">#&gt;  [99] graph_1.88.0                cli_3.6.5                  </span></span>
<span><span class="co">#&gt; [101] affyio_1.80.0               rpart_4.1.24               </span></span>
<span><span class="co">#&gt; [103] systemfonts_1.3.1           jquerylib_0.1.4            </span></span>
<span><span class="co">#&gt; [105] MassSpecWavelet_1.76.0      readxl_1.4.5               </span></span>
<span><span class="co">#&gt; [107] XML_3.99-0.20               parallel_4.5.2             </span></span>
<span><span class="co">#&gt; [109] pkgdown_2.2.0               readr_2.1.5                </span></span>
<span><span class="co">#&gt; [111] prettyunits_1.2.0           AnnotationFilter_1.34.0    </span></span>
<span><span class="co">#&gt; [113] MsFeatures_1.18.0           scales_1.4.0               </span></span>
<span><span class="co">#&gt; [115] affy_1.88.0                 ncdf4_1.24                 </span></span>
<span><span class="co">#&gt; [117] purrr_1.2.0                 crayon_1.5.3               </span></span>
<span><span class="co">#&gt; [119] rlang_1.1.6                 vsn_3.78.0</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jan Stanstrup.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
